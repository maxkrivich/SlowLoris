language: python

cache: pip

python:
 - "3.8"

 # FIXME(mkrivich): fix ci
install:
  - pip install poetry
  - python -m venv ./venv
  - poetry install -v
  - ls -la
  - poetry export -f requirements.txt > requirements.txt
  - ls -la
  - ./venv/bin/pip install -r requirements.txt
  - poetry build && ./venv/bin/pip install dist/*.whl

before_script:
  - poetry run flake8 ./pyslowloris

script:
  - poetry run pytest

branches:
  only:
    - master
    - develop

notifications:
  email:
    recipients:
      -  maxkrivich@gmail.com
    on_success: never
    on_failure: always